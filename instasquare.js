// Generated by CoffeeScript 1.9.3
(function(){var t,e,o;t=function(){function i(t,e){var o,i;if(this.options={target:"instafeed",get:"popular",resolution:"thumbnail",sortBy:"none",square:!1,links:!0,mock:!1,useHttp:!1},"object"==typeof t)for(o in t)i=t[o],this.options[o]=i;this.context=null!=e?e:this,this.unique=this._genKey()}return i.prototype.hasNext=function(){return"string"==typeof this.context.nextUrl&&0<this.context.nextUrl.length},i.prototype.next=function(){return!!this.hasNext()&&this.run(this.context.nextUrl)},i.prototype.run=function(t){var e,o;if("string"!=typeof this.options.clientId&&"string"!=typeof this.options.accessToken)throw new Error("Missing clientId or accessToken.");if("string"!=typeof this.options.accessToken&&"string"!=typeof this.options.clientId)throw new Error("Missing clientId or accessToken.");return null!=this.options.before&&"function"==typeof this.options.before&&this.options.before.call(this),"undefined"!=typeof document&&null!==document&&((o=document.createElement("script")).id="instafeed-fetcher",o.src=t||this._buildUrl(),document.getElementsByTagName("head")[0].appendChild(o),e="instafeedCache"+this.unique,window[e]=new i(this.options,this),window[e].unique=this.unique),!0},i.prototype.parse=function(t){var e,o,i,n,r,s,a,p,c,l,h,u,d,f,m,g,y,w,b,k,v,_,E,x,I,N,T,q,B,j,C;if("object"!=typeof t){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"Invalid JSON data"),!1;throw new Error("Invalid JSON response")}if(200!==t.meta.code){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,t.meta.error_message),!1;throw new Error("Error from Instagram: "+t.meta.error_message)}if(0===t.data.length){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"No images were returned from Instagram"),!1;throw new Error("No images were returned from Instagram")}if(null!=this.options.success&&"function"==typeof this.options.success&&this.options.success.call(this,t),this.context.nextUrl="",null!=t.pagination&&(this.context.nextUrl=t.pagination.next_url),"none"!==this.options.sortBy)switch(N="least"===(T="random"===this.options.sortBy?["","random"]:this.options.sortBy.split("-"))[0],T[1]){case"random":t.data.sort(function(){return.5-Math.random()});break;case"recent":t.data=this._sortBy(t.data,"created_time",N);break;case"liked":t.data=this._sortBy(t.data,"likes.count",N);break;case"commented":t.data=this._sortBy(t.data,"comments.count",N);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}if("undefined"!=typeof document&&null!==document&&!1===this.options.mock){if(d=t.data,I=parseInt(this.options.limit,10),null!=this.options.limit&&d.length>I&&(d=d.slice(0,I)),s=document.createDocumentFragment(),null!=this.options.filter&&"function"==typeof this.options.filter&&(d=this._filter(d,this.options.filter)),null!=this.options.template&&"string"==typeof this.options.template){for(h=a="",j=document.createElement("div"),p=0,v=d.length;p<v;p++){if("object"!=typeof(l=(c=d[p]).images[this.options.resolution]))throw r="No image found for resolution: "+this.options.resolution+".",new Error(r);y=l.width,g="square",(m=l.height)<y&&(g="landscape"),y<m&&(g="portrait"),u=l.url,0<=window.location.protocol.indexOf("http")&&!this.options.useHttp&&(u=u.replace(/https?:\/\//,"//")),h=this._makeTemplate(this.options.template,{model:c,id:c.id,link:c.link,type:c.type,image:u,width:y,height:m,orientation:g,caption:this._getObjectProperty(c,"caption.text"),likes:c.likes.count,comments:c.comments.count,location:this._getObjectProperty(c,"location.name")}),!0===this.options.square&&((C=document.createElement("div")).innerHTML=h,(B=C.querySelector("img[src='"+u+"']"))&&(B.parentNode.replaceChild(this._enforceSquare(B),B),h=C.innerHTML)),a+=h}for(j.innerHTML=a,n=[],i=0,o=j.childNodes.length;i<o;)n.push(j.childNodes[i]),i+=1;for(b=0,_=n.length;b<_;b++)x=n[b],s.appendChild(x)}else for(k=0,E=d.length;k<E;k++){if(c=d[k],f=document.createElement("img"),"object"!=typeof(l=c.images[this.options.resolution]))throw r="No image found for resolution: "+this.options.resolution+".",new Error(r);u=l.url,0<=window.location.protocol.indexOf("http")&&!this.options.useHttp&&(u=u.replace(/https?:\/\//,"//")),f.src=u,!0===this.options.square&&(f=this._enforceSquare(f)),!0===this.options.links?((e=document.createElement("a")).href=c.link,e.appendChild(f),s.appendChild(e)):s.appendChild(f)}if("string"==typeof(q=this.options.target)&&(q=document.getElementById(q)),null==q)throw r='No element with id="'+this.options.target+'" on page.',new Error(r);q.appendChild(s),document.getElementsByTagName("head")[0].removeChild(document.getElementById("instafeed-fetcher")),w="instafeedCache"+this.unique,window[w]=void 0;try{delete window[w]}catch(t){t}}return null!=this.options.after&&"function"==typeof this.options.after&&this.options.after.call(this),!0},i.prototype._buildUrl=function(){var t,e;switch("https://api.instagram.com/v1",this.options.get){case"popular":t="media/popular";break;case"tagged":if(!this.options.tagName)throw new Error("No tag name specified. Use the 'tagName' option.");t="tags/"+this.options.tagName+"/media/recent";break;case"location":if(!this.options.locationId)throw new Error("No location specified. Use the 'locationId' option.");t="locations/"+this.options.locationId+"/media/recent";break;case"user":if(!this.options.userId)throw new Error("No user specified. Use the 'userId' option.");t="users/"+this.options.userId+"/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}return e="https://api.instagram.com/v1/"+t,null!=this.options.accessToken?e+="?access_token="+this.options.accessToken:e+="?client_id="+this.options.clientId,null!=this.options.limit&&(e+="&count="+this.options.limit),e+="&callback=instafeedCache"+this.unique+".parse"},i.prototype._genKey=function(){var t;return""+(t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)})()+t()+t()+t()},i.prototype._makeTemplate=function(t,e){var o,i,n,r,s;for(i=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/,o=t;i.test(o);)r=o.match(i)[1],s=null!=(n=this._getObjectProperty(e,r))?n:"",o=o.replace(i,function(){return""+s});return o},i.prototype._enforceSquare=function(t){var e,o;return(e=document.createElement("div")).setAttribute("class","instafeed-image-square"),o="height:0; overflow:hidden; position: relative; padding-top:100%;","objectFit"in document.documentElement.style==!0?(e.style.cssText=o,t.style.cssText="height: 100%; left: 0; object-fit:cover; position:absolute; top: 0; width: 100%;",e.appendChild(t.cloneNode())):e.style.cssText=o+" background-size:cover; background-repeat:no-repeat; background-position:center; background-image:url("+t.src+");",e},i.prototype._getObjectProperty=function(t,e){var o,i;for(i=(e=e.replace(/\[(\w+)\]/g,".$1")).split(".");i.length;){if(o=i.shift(),!(null!=t&&o in t))return null;t=t[o]}return t},i.prototype._sortBy=function(t,n,r){var e;return e=function(t,e){var o,i;return o=this._getObjectProperty(t,n),i=this._getObjectProperty(e,n),r?i<o?1:-1:o<i?1:-1},t.sort(e.bind(this)),t},i.prototype._filter=function(t,e){var o,i,n,r;for(o=[],i=function(t){if(e(t))return o.push(t)},n=0,r=t.length;n<r;n++)i(t[n]);return o},i}(),e=this,o=function(){return t},"function"==typeof define&&define.amd?define([],o):"object"==typeof module&&module.exports?module.exports=o():e.Instafeed=o()}).call(this);
